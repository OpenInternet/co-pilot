#!/bin/bash

readonly custom_profile="/tmp/copilot/dnschef.conf"
readonly command="/usr/bin/dnschef"

start_dnschef() {
    if [[ -e "$custom_profile" ]]; then
        echo "Starting with a custom DNSChef profile."
        "$command" --file="$custom_profile"
    else
        echo "Starting with an empty DNSChef profile."
        "$command"
    fi
}

kill_all() {
    kill $(pgrep -f python.*dnschef)
    exit
}

main() {
    start_dnschef
}
trap 'kill_all "caught signal"' TERM HUP KILL QUIT
main
