#!/bin/bash

readonly default_profile='wlan0 eth0 copilot copilot_pass'

start_create_ap() {
    if [[ -e /tmp/copilot/ap.conf ]]; then
        echo "Starting with a custom create_ap profile."
        commands=$(cat /tmp/copilot/ap.conf)
        /usr/bin/create_ap ${commands}
    else
        echo "Starting with the default create_ap profile."
        /usr/bin/create_ap ${default_profile}
    fi
}

kill_all() {
    create_ap --stop $(create_ap --list| cut -d " " -f 1)
    exit
}


main() {
    start_create_ap
}
trap 'kill_all "caught signal"' TERM HUP KILL QUIT
main
